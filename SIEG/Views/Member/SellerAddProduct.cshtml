@{
	ViewData["Title"] = "賣家售價訂單";
	ViewData["enTitle"] = "Ben";
}

@section Style{
	<link href="~/css/BEN.css" rel="stylesheet">
}
	<div id="appVue">
		<partial name="_MemberBanner" />
		<div class="container-fluid">
			<div class="row">
				<partial name="_Membersidebar">
					<div class="col-lg-9">
						<div class="orderTopWidth">
							<h4>售出</h4>
							<ul class="nav nav-tabs" role="tablist">
								<li class="nav-item" role="presentation">
									<button class="nav-link active" data-bs-toggle="tab" data-bs-target="#Currently"
										type="button" role="tab" aria-selected="true">
										<a class="orderTopWidth-1">目前</a>
									</button>
								</li>
								<li class="nav-item" role="presentation">
									<button class="nav-link" data-bs-toggle="tab" data-bs-target="#determined" type="button"
										role="tab" aria-selected="false" @@click="getDTOes">
										<a class="orderTopWidth-1">待定 </a>
									</button>
								</li>
								<li class="nav-item" role="presentation">
									<button class="nav-link" data-bs-toggle="tab" data-bs-target="#history" type="button"
										role="tab" aria-selected="false">
										<a class="orderTopWidth-1">歷史紀錄</a>
									</button>
								</li>
							</ul>
							<hr>
							</a>
						</div>
						<div class="tab-content">
							<!-- 目前出價 -->
							<div class="tab-pane fade show active" id="Currently" role="tabpanel">
								<table class="table">
									<thead>
										<tr>
											<th>商品</th>
											<th>報價</th>
											<th>最低報價</th>
											<th>最高出價</th>
											<th>到期日</th>
											<th></th>
										</tr>
									</thead>
									<tbody>
										<tr v-for="item in SellerAddProductsDTOes">
											<td class="imgTd" data-title="商品">
												<img :src="item.imgFront" class="imgWidth">
												<div class="imgMargin">
													<div>{{item.productName}}</div>
													<span class="nameDilute">{{item.model}}</span>
													<div>
														<p class=" badge rounded-pill Pcolor">us{{item.size}}</p>
													</div>
												</div>
											</td>
											<td data-title="報價">NT$<input v-model="item.price" /></td>
											<td data-title="最低報價">NT${{item.lowPrice}}</td>
											<td data-title="最高出價">{{item.hightPrice}}</td>
											<td data-title="到期日">{{item.newShelfdate}}</td>
											<td data-title="">
												<button type="button" class="btn btncolor">編輯</button>
												<button type="button" class="btn btn-link">
													<img src="~/images/Benicon/trash.png" class="AccountIcon">
												</button>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
							<!-- 待定 -->
							<div class="tab-pane fade" id="determined" role="tabpanel">
								<table class="table">
									<thead>
										<tr>
											<th>商品</th>
											<th>訂單編號</th>
											<th>成交價格</th>
											<th>狀態</th>
										</tr>
									</thead>
									<tbody>
										<tr v-for="item in SellOrderDTOes" v-if="item.state!='已完成'">
											<td class="imgTd" data-title="商品">
												<img :src="item.imgFront" class="imgWidth">
												<div class="imgMargin">
													<div>{{item.productName}}</div>
													<span class="nameDilute">{{item.model}}</span>
													<div>
														<p class=" badge rounded-pill Pcolor">us{{item.size}}</p>
													</div>
												</div>
											</td>
											<td data-title="訂單編號">{{item.OrderId}}</td>
											<td data-title="成交價格">NT${{item.price}}</td>
											<td data-title="狀態">{{item.state}}</td>
										</tr>
									</tbody>
								</table>
							</div>
							<!-- 歷史紀錄 -->
							<div class="tab-pane fade" id="history" role="tabpanel">
								<div class="searchlocation">
									<input class="form-control" type="text" placeholder="收尋名稱" id="aaaa" v-model="FilterSellerOrder">
									<button type="button" class="btn" id="btnlocation" @@click="filtersellerorder">篩選</button>
								</div>
								<hr>
								<table class="table">
									<thead>
										<tr>
											<th>商品</th>
											<th>訂單編號</th>
											<th>購買日期</th>
											<th>成交價錢</th>
											<th>狀態</th>
										</tr>
									</thead>
									<tbody>

										<tr class="detailbgcolor" data-title="商品" v-for="item in SellOrderDTOes" v-if="item.state=='已完成'">
											<td class="imgTd-1" data-bs-toggle="modal" :data-bs-target="'#'+item.num" :id="item.OrderId">
												<img :src="item.imgFront" class="imgWidth">
												<div class="imgMargin" :id="item.OrderId">
													<div :id="item.OrderId">{{item.productName}}</div>
													<span :id="item.OrderId" class="nameDilute">{{item.model}}</span>
													<div :id="item.OrderId">
														<p class=" badge rounded-pill Pcolor">us{{item.size}}</p>
													</div>
												</div>
											</td>
											<td data-title="訂單編號">{{item.OrderId}}</td>
											<td data-title="購買日期">{{item.newCompleteTime}}</td>
											<td data-title="成交價錢">NT${{item.price}}</td>
											<td data-title="狀態">{{item.state}}</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
			</div>
			<!-- modal -->
			<div v-for="item in SellOrderDTOes">
				<div class="modal fade" :id="item.num" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="exampleModalLabel">訂單細節</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
								<img :src="item.imgFront" class="imgWidth">
								<div class="orderdetail">
									<span>訂單編號:</span>
									<span>{{item.OrderId}}</span>
								</div>
								<div class="orderdetail">
									<span>商品名稱:</span>
									<span>{{item.productName}}</span>
								</div>
								<div class="orderdetail">
									<span>商品尺寸:</span>
									<span>us{{item.size}}</span>
								</div>
								<div class="orderdetail">
									<span>賣出日期:</span>
									<span>{{item.newCompleteTime}}</span>
								</div>
								<div class="orderdetail">
									<span>售出價錢:</span>
									<span>NT${{item.price}}</span>
								</div>
								<div class="orderdetail">
									<span>訂購人:</span>
									<span>{{item.receiver}}</span>
								</div>
								@*	<div class="orderdetail">
							<span>收貨人:</span>
							<span>盧冠佑</span>
							</div>*@
								<div class="orderdetail">
									<span>寄送地址:</span>
									<span>{{item.shippingAddress}}</span>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	@section Scripts
	{
	<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.2/axios.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script>
		var webApiBaseAddress = "https://localhost:7139";
		var appVue = new Vue({
			el: "#appVue",
			name: "appVue",
			data: {
				mID:sessionStorage.getItem("mID"),
				SellOrderDTOes: [],
				SellerAddProductsDTOes: [],
				FilterSellerOrder: "",
				//Id: null,
				num: null,
				newCompleteTime: null,
				newShelfdate: null,
			},
			mounted: function () {
				let _this = this;
				_this.getSellOrderDTOes();
				_this.getSellerAddProductsDTOes();
			},
			methods: {
				getSellOrderDTOes: function () {
					let _this = this;
					axios.get(`${webApiBaseAddress}/api/B_Sellerorder/${_this.mID}`).then(
						response => {
							_this.SellOrderDTOes = response.data;
							var SellOrderList = [];
							for (var i = 0; i < _this.SellOrderDTOes.length; i++) {
								var item = {};
								item = _this.SellOrderDTOes[i];
								item.num = "A" + item.orderId;
								var str = item.completeTime;
								item.newCompleteTime = str.split("T")[0];
								SellOrderList.push(item);

							}
							_this.SellOrderDTOes = SellOrderList;
						}
					);
				},
				getSellerAddProductsDTOes: function () {
					let _this = this;
					axios.get(`${webApiBaseAddress}/api/B_SellerAddProducts/${102}`).then(
						response => {
							_this.SellerAddProductsDTOes = response.data;
							var SellerAddProductsList = [];
							for (var i = 0; i < _this.SellerAddProductsDTOes.length; i++) {
								var item = {};
								item = _this.SellerAddProductsDTOes[i];
								item.Edit = false;
								var str = item.shelfdate;
								item.newShelfdate = str.split("T")[0];
								SellerAddProductsList.push(item);

							}
							_this.SellerAddProductsDTOes = SellerAddProductsList;
						}
					);
				},
				getDTOes: function () {
					this.FilterSellerOrder = "";
					let _this = this;
					_this.getSellOrderDTOes();
				},

				filtersellerorder: function () {
					let _this = this;
					var request = {};
					if (_this.FilterSellerOrder == "" || _this.FilterSellerOrder == null) {
						_this.getSellOrderDTOes();
					}
					else {
						request.Id = _this.FilterSellerOrder
						axios.post(`${webApiBaseAddress}/api/訂單賣家/Filter/${102}`, request).then(
							response => {
								_this.SellOrderDTOes = response.data;
								var 賣家出價訂單List = [];
								for (var i = 0; i < _this.SellOrderDTOes.length; i++) {
									var item = {};
									item = _this.SellOrderDTOes[i];
									item.num = "A" + item.id;
									var str = item.完成時間;
									item.new完成時間 = str.split("T")[0];
									賣家出價訂單List.push(item);
								}
								_this.SellOrderDTOes = 賣家出價訂單List;

							}
						);
					}
				},
			},
		});
	</script>

    }
